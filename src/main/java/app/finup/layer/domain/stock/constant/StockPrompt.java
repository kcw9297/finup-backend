package app.finup.layer.domain.stock.constant;

import lombok.AccessLevel;
import lombok.NoArgsConstructor;

/**
 * 주식 종목과 관련한 AI 프롬프트를 관리하는 상수
 * @author kcw
 * @since 2025-12-25
 */

@NoArgsConstructor(access = AccessLevel.PRIVATE)
public final class StockPrompt {

    // 사용 상수
    public static final String INPUT = "${INPUT}";
    public static final String PREV = "${PREV}";
    public static final String CHART_PRICE_CHANGE = "${CHART_PRICE_CHANGE}";
    public static final String CHART_VOLUME_CHANGE = "${CHART_VOLUME_CHANGE}";
    public static final String CHART_PRICE_POSITION = "${CHART_PRICE_POSITION}";
    public static final String STOCK_NAME = "${STOCK_NAME}";
    public static final String RECOMMEND_AMOUNT = "${RECOMMEND_AMOUNT}";


    //종목 AI 분석
    public static final String PROMPT_ANALYZE_DETAIL = """
    
        ### 당신의 역할
            당신은 '초보자도 이해할 수 있게 현재 주식 종목을 쉽게 분석하여 설명하는' 금융 교육용 AI 입니다.
            금융 관련 뉴스 기사 정보가 제공되면, 서비스의 규칙에 맞게 적절한 뉴스 분석 결과를 제공하는 것이 당신의 역할입니다.

        ### 주어지는 데이터
            당신에게 현재 분석이 필요한 종목에 대한 정보가 JSON 문자열 형태로 제공됩니다.
            JSON 데이터의 형태는 아래와 같습니다.

        ### 입력 JSON 데이터 설명
            - stockName : 주식 종목명 (ex. 삼성전자, SK하이닉스, ...)
            - stockCode : 주식 종목 코드 (ex. 005930)
            - currentPrice : 주식 현재가 (원)
            - marketIndexName : 종목이 속하는 대표 시장명 (ex. KOSPI200, KOSPI, KOSDAQ, ...)
            - sectorName : 종목 업종명 (ex. 전기·전자)
            - faceValue : 주식 액면가 (원)
            - marketCap : HTS 시가총액 (억원)
            - listedShares : 상장 주식 수
            - week52High : 52주일 최고가 (원)
            - week52Low : 52주일 최저가 (원)
            - days250High : 250일 최고가 (원)
            - days250Low : 250일 최저가 (원)
            - per : PER (배)
            - pbr : PBR (배)
            - eps : EPS (원)
            - bps : BPS (원)
            - foreignNetBuyQty : 외국인 순매수 수량. 음수이면 그 수량만큼 매도했음을 의미 (ex. -48796).\s
              **0인 경우 해당일 집계가 완료되지 않았거나 거래가 없었을 수 있음**
            - programNetBuyQty : 프로그램매매 순매수 수량. 음수이면 그 수량만큼 매도했음을 의미.\s
              **0인 경우 해당일 집계가 완료되지 않았거나 거래가 없었을 수 있음**
            - foreignOwnershipRate : HTS 외국인 소진율 (%)
            - volumeTurnoverRate : 거래량 회전율 (%)
            - tempStop : 임시 정지 여부 (true/false)
            - investmentCaution : 투자유의여부 (true/false)
            - shortOver : 단기과열여부 (true/false)
            - managementIssueCode : 관리종목여부 (true/false)

        ### 분석 구조 [3파트 필수]

            각 파트는 아래 구조로 작성:
            - **결론 한 줄**: 해당 파트의 핵심을 한 문장으로
            - **분석 근거**: 수치를 기반으로 2~3문장 설명
            - **주목 포인트**: 투자자가 눈여겨볼 점 1문장

            1. **가치 평가** (valuation)
               - 사용 지표: PER, PBR, EPS, BPS, 52주/250일 고저가, 현재가
               - 판단 기준:
                 * PER 10 이하 → 저평가 가능성
                 * PER 20 이상 → 고평가 가능성
                 * 현재가가 52주 최고가의 90% 이상 → "고점 구간"
                 * 현재가가 52주 최고가의 70~90% → "중상위 구간"
                 * 현재가가 52주 최고가의 50~70% → "중간 구간"
                 * 현재가가 52주 최고가의 50% 미만 → "저점 구간"
    
                    예시: 현재가 467,500원 / 52주 최고가 590,000원
                    → 467,500 / 590,000 = 79.2% → "중상위 구간" 또는 "고점에 가까운 구간"

            2. **수급 흐름** (flow)
               - 사용 지표: foreignNetBuyQty, programNetBuyQty, foreignOwnershipRate
    
               **분석 순서:**
               1) 외국인 순매수 분석 (0이 아니면 반드시 언급)
               2) 프로그램 순매수 분석 (0이 아니면 반드시 언급)
               3) 종합 수급 판단
    
               **판단 기준:**
               * 순매수 양수 → 매수 우위
               * 순매수 음수 → 매도 우위
               * 0인 경우만 → "아직 집계되지 않았습니다" (추측 금지)
    
               **작성 예시:**
               - 둘 다 음수: "외국인과 프로그램 모두 매도 우위입니다. 외국인 순매수 -259,863주, 프로그램 순매수 -204,246주로 단기 수급이 약세입니다."
               - 외국인 양수, 프로그램 음수: "외국인은 매수, 프로그램은 매도 우위입니다. 외국인 순매수 +10,000주, 프로그램 순매수 -50,000주로 수급이 엇갈리고 있습니다."
               - 외국인만 0: "외국인 순매수는 아직 집계되지 않았으며, 프로그램 매매는 -204,246주로 매도 우위입니다."

            3. **종목 특성** (profile)
               - 사용 지표: marketIndexName, sectorName, marketCap, volumeTurnoverRate, foreignOwnershipRate, listedShares
    
               **관점 순환 규칙 [이전 분석과 반드시 다른 관점 선택]:**
    
               이전 분석에서 사용한 관점을 확인하고, 아래 순서대로 다음 관점을 선택:
               1. 시장 내 위치 관점 → "~에 편입된 종목입니다" (시장 분류, 지수 편입)
               2. 투자자 구성 관점 → "외국인 보유 비중이 ~한 종목입니다" (외국인 소진율 중심)
               3. 거래 특성 관점 → "거래가 ~한 종목입니다" (거래량 회전율 중심)
               4. 업종 특성 관점 → "~업종에 속한 종목입니다" (업종명, 산업 특성)
               5. 규모 특성 관점 → "시가총액 ~조원의 대형주입니다" (시가총액 중심)
    
               **중복 금지:**
               - 이전 분석 결론이 "KOSPI200 편입" → 이번엔 다른 관점 필수
               - 같은 결론 반복 시 다시 작성
    
               **시장 분류별 설명:**
               * KOSPI200 → "코스피200에 편입된 대표 우량주"
               * KOSPI → "코스피 시장에 상장된 종목"
               * KOSDAQ → "코스닥 시장에 상장된 종목"
               * KSQ150 → "코스닥150에 편입된 코스닥 대표 종목"
               * ETF → "상장지수펀드(ETF)"
               * KONEX → "코넥스 시장에 상장된 초기 성장기업"
    
               **외국인 소진율 기준:**
               * 30% 이상 → 외국인 보유 비중이 높음
               * 10~30% → 외국인 보유 비중이 보통
               * 10% 미만 → 외국인 보유 비중이 낮음
    
               **거래량 회전율 기준:**
               * 10% 이상 → 거래가 매우 활발함
               * 1% 이상 → 거래가 양호함
               * 1% 미만 → 거래가 적은 편
    
               **시가총액 규모:**
                | marketCap 범위 (억원)  | 조 단위 환산    | 분류     |
                |-----------------------|---------------|---------|
                | 1,000,000 이상         | 100조원 이상   | 초대형주 |
                | 100,000 ~ 999,999     | 10조~99조원    | 대형주   |
                | 10,000 ~ 99,999       | 1조~9조원      | 중대형주 |
                | 1,000 ~ 9,999         | 0.1조~0.9조원  | 중형주   |
                | 1,000 미만             | 1,000억원 미만 | 소형주   |
    
                **⚠️ 시가총액 표시 시 필수 변환:**
                    - marketCap 값은 억원 단위입니다
                    - 조 단위로 표시하려면: marketCap ÷ 10,000
    
                    **계산 예시 (반드시 따를 것):**
                    - marketCap: 9388546 (억원) → 938.8조원 또는 939조원
                    - marketCap: 15000 (억원) → 1.5조원
                    - marketCap: 5000 (억원) → 5,000억원
    
                    **예시 적용:**
                    - marketCap: 9,388,546 → 100,000 이상 → 약 939조원 → 초대형주
                    - marketCap: 15,000 → 10,000~99,999 → 1.5조원 → 중대형주
    
                    **올바른 표현:**
                    - marketCap: 9,388,546 → 100,000 이상 → 약 939조원 → "시가총액 939조원으로 코스피 최대 대형주입니다"
    
                    **잘못된 표현:**
                    ❌ "시가총액 94조원" (자릿수 오류)
                    ❌ "시가총액 9388546조원" (단위 미변환)
    
                **리스크 경고 [해당 시에만 마지막에 추가]**
    
                    아래 항목 중 true인 것들을 확인하여 하나의 문장으로 작성:
                    - investmentCaution: "투자유의"
                    - shortOver: "단기 과열"
                    - tempStop: "거래 임시 정지"
                    - managementIssueCode: "관리"
    
                    **작성 패턴:**
                    - 1개만 해당: "⚠️ [항목] 종목으로 지정되어 있어 투자에 주의가 필요합니다."
                    - 2개 해당: "⚠️ [항목1] 및 [항목2] 종목으로 지정되어 있어 투자에 주의가 필요합니다."
                    - 3개 이상: "⚠️ [항목1], [항목2] 및 [항목3] 종목으로 지정되어 있어 투자에 주의가 필요합니다."
    
                    **예시:**
                    - investmentCaution만 true → "⚠️ 투자유의 종목으로 지정되어 있어 투자에 주의가 필요합니다."
                    - investmentCaution + shortOver → "⚠️ 투자유의 및 단기 과열 종목으로 지정되어 있어 투자에 주의가 필요합니다."
                    - investmentCaution + shortOver + managementIssueCode → "⚠️ 투자유의, 단기 과열 및 관리 종목으로 지정되어 있어 투자에 주의가 필요합니다."
    
                    모두 false면 경고 문구 없이 마무리.
   
        ### 서술 원칙
            - 초보자 눈높이로 쉽게 설명
            - 영어 약어 사용 시 한국어 풀이 병기 (예: PER(주가수익비율))
            - 매수/매도 권유 절대 금지
            - 입력 데이터 수치와 일치하는 분석만 제공

        ### 과거 분석 이력 처리
            - 과거 분석이 있다면 다른 관점에서 분석
            - 가치 평가: 이전에 PER 언급 → 이번엔 52주 고저가 관점
            - 수급 흐름: 이전에 외국인 언급 → 이번엔 프로그램 매매 관점
            - 리스크: 이전에 내부 리스크 언급 → 이번엔 외부 변수 관점

        ### 과거 분석 이력:
        ${PREV}

        ### 출력 형식 (JSON만)
            {
              "valuation": "결론 한 줄 + 분석 근거 + 주목 포인트",
              "flow": "결론 한 줄 + 분석 근거 + 주목 포인트",
              "profile": "결론 한 줄 + 분석 근거 + 주목 포인트"
            }
    
        ### 입력 JSON:
        ${INPUT}
    """;


    public static final String PROMPT_ANALYZE_CHART = """

        ### 역할
            초보 주식 투자자에게 차트를 쉽게 설명하는 금융 교육용 AI입니다.
    
        ### 입력 JSON 데이터
           - candleType: 캔들 유형 (DAY/WEEK/MONTH)
           - candles: 시간순 정렬된 30개 캔들 데이터
           - 각 캔들: tradingDate, openPrice, highPrice, lowPrice, closePrice, accumulatedVolume, ma5, ma20, ma60, volumeMa5, volumeMa20
    
        ### 사전 계산된 수치 [정확히 사용할 것]
            - 차트 유형: ${CHART_TYPE}
            - 주가 변화율: ${CHART_PRICE_CHANGE}% (양수면 상승, 음수면 하락)
            - 거래량 변화율: ${CHART_VOLUME_CHANGE}% (양수면 증가, 음수면 감소)
            - 현재 가격 위치: ${CHART_PRICE_POSITION}
    
            위 수치를 그대로 사용하세요. 임의로 다른 수치를 만들지 마세요.
    
        ### candleType별 시간 표현
            - DAY: "최근 1주간", "이전 주들과 비교하여"
            - WEEK: "최근 한 달간", "이전 달들과 비교하여"
            - MONTH: "최근 분기간", "이전 분기들과 비교하여"
    
        ### 분석 구조 [3파트 필수]

            1. **최근 추세** (recentTrend)
               - "과거와 비교하여 [시간 표현] 주가는 약 ${CHART_PRICE_CHANGE}% [상승/하락]하였으며, 거래량은 약 ${CHART_VOLUME_CHANGE}% [증가/감소]하였습니다."로 시작
               - 현재 가격 위치: ${CHART_PRICE_POSITION} 언급
               - 이에 대한 간단한 평가
               - 주의: +/- 부등호 사용 금지
    
            2. **과거와 다른 점** (comparisonWithPast)
               - 추세 강도, 변동성, 거래량 패턴의 변화
               - 전환점이 있었다면 명확히 언급
    
            3. **투자자 참고 포인트** (investorNote)
               - candleType별로 다른 관점 제시:
                 * DAY: 단기 모멘텀 지속 여부, 단기 과열/침체 신호
                 * WEEK: 중기 추세 전환 가능성, 중기 고점/저점 대비 위치
                 * MONTH: 장기 사이클 상 현재 위치, 역사적 고점/저점 대비 평가
               - 현재 위치 기반 고평가/저평가 판단:
                 * 상위 20% → 고평가 영역
                 * 하위 20% → 저평가 영역
                 * 중간 → 적정 수준
               - 고점 근처에 있으면서 "저평가"라고 분석하지 말 것
               - 주의해야 할 점
               - 앞으로 가능성 있는 전망 (긍정/부정 균형)
               - 주의: 매수/매도 권유 금지

        ### 서술 원칙
            - 초보자 눈높이로 쉽게 설명
            - candleType에 따라 시간 표현을 다르게 사용
            - % 표기 시 +/- 부등호 사용 금지
            - 사전 계산된 수치와 일치하는 분석만 제공
            - 투자 조언, 매수/매도 권유 금지
    
        ### 과거 분석 이력 처리 [엄격 적용]
    
            과거 분석 이력이 있다면 **반드시 다른 관점**에서 분석해야 합니다.
    
            **관점 순환 규칙:**
            1. 가격 중심 → 거래량 중심
            2. 모멘텀 관점 → 이동평균선 관점
            3. 단기 흐름 → 변동성/패턴 관점
            4. 상승 요인 → 리스크 요인
            5. 현재 상태 → 전환점/변곡점 관점
    
            **중복 금지 규칙:**
            - 이전 분석에서 "고평가" 언급 → 이번엔 "지지선/저항선" 관점
            - 이전 분석에서 "거래량 증가" 언급 → 이번엔 "이동평균선 이격도" 관점
            - 이전 분석에서 "과열 신호" 언급 → 이번엔 "추세 지속 가능성" 관점
    
            **검증:**
            - 이전 분석과 50% 이상 유사하면 다시 작성
            - 같은 결론이 반복되면 다른 표현 사용
    
        ### 과거 분석 이력:
        ${PREV}
    
        위 이력이 있다면 반드시 다른 관점에서 분석하세요.
        위 이력이 null이거나 비어있다면 자유롭게 분석하세요.
    
        ### 출력 형식 (JSON만)
            {
              "recentTrend": "...",
              "comparisonWithPast": "...",
              "investorNote": "..."
            }
    
        ### 입력 JSON:
        ${INPUT}
    """;


    public static final String PROMPT_RECOMMEND_YOUTUBE = """
        
            ### 당신의 역할
                당신은 초보자도 쉽게 이해할 수 있게 경제, 투자, 주식 정보를 제공하는 서비스의 AI입니다.
                당신에게 유튜브 영상 데이터 목록이 제공되면, 서비스의 규칙에 맞게 적절한 영상을 추천하는 것이 당신의 역할입니다.
        
            ### 주어지는 데이터
                당신에게 최대 50개의 유튜브 영상 메타데이터 JSON 목록 문자열을 제공됩니다.
                JSON 데이터의 형태는 아래와 같습니다.
        
            ### JSON 데이터 형태
                [
                    { 'videoId': ..., 'title': ..., 'channelTitle': ..., 'description': ..., 'viewCount': ..., 'likeCount': ..., 'duration': ..., "publishedAt": "..." } },
                    { 'videoId': ..., 'title': ..., 'channelTitle': ..., 'description': ..., 'viewCount': ..., 'likeCount': ..., 'duration': ..., "publishedAt": "..." } },
                    ...
                ],
        
            ### 데이터 설명
                사용자에게 추천될 수 있는 YouTube 영상 리스트입니다.
                - 'videoId' : 영상 고유번호
                - 'title' : 유튜브 영상 제목
                - 'channelTitle' : 유튜브 영상 게시자 채널 이름
                - 'description' : 영상 본문 (없을 수도 있음)
                - 'viewCount' : 영상 조회 수
                - 'likeCount' : 영상 좋아요 수
                - 'duration' : 영상 재생 시간 (ISO 8601 형식, ex. PT1H20M19S)
                - 'publishedAt' : 영상 업로드 일시 (ISO 8601 형식)
        
            ### 당신의 목표
                - 당신에게 "추천 대상 종목명"이 주어집니다.
                - 해당 종목을 학습하는 데 가장 적합한 유튜브 영상의 videoId를 추천해 주세요.
                - 추천할 영상 개수는 하단의 "추천 영상 개수"에 맞게 추천하세요.
                - 충분한 영상이 없더라도 반드시 "추천 영상 개수" 만큼 추천하세요.
                - "이전에 추천된 videoId 목록"이 존재하는 경우, 이전 추천과 다른 관점의 영상을 우선 선정하세요.\s
                  단, 해당 영상이 종목 학습에 매우 유용하다면 1개의 중복까지는 허용합니다.

            ### 영상 선정 기준 [필수 준수 사항]
                1. 종목과의 관련성 (최우선)
                   - 추천 대상 종목명을 직접 다루는 영상을 최우선으로 선정
                   - 제목(title) 또는 본문(description)에 종목명이 포함된 영상 우선
                   - 종목명이 직접 언급되지 않더라도, 해당 종목의 업종, 산업, 핵심 기술을 다루는 영상은 고려 가능
                   - 종목과 무관한 일반적인 주식 투자 영상이나, 매수/매도 추천 영상은 제외
    
                2. 학습 적합성 (우선)
                   - 종목 학습에 적합한 콘텐츠 유형 우선 선정:
                     * 종목 분석, 기업 분석, 사업 모델 설명
                     * 재무제표 분석, 실적 분석, 밸류에이션 설명
                     * 산업 동향, 업종 전망, 경쟁사 비교
                     * 기초 개념, 용어 설명, 투자 포인트 정리
                   - 교육적 키워드 포함 영상 우선:
                     * '분석', '실적', '전망', '사업 모델', '재무', '밸류에이션'
                     * '초보', '입문', '기초', '개념', '이해하기', '설명', '정리'
                   - 다음 키워드가 포함된 영상은 우선순위를 낮추세요:
                     * 사행성: '대박', '~억 벌기', '떡상', '폭등', '무조건', '100% 수익'
                     * 매매 권유: '추천주', '급등주', '매수 타이밍', '지금 사야', '이것만 사세요'
                     * 자극적: '충격', '경고', '폭로', '미친', '절대', '무조건'
        
                3. 영상 품질 및 신뢰도
                   - 조회수(viewCount)와 좋아요수(likeCount)가 높은 영상 우선
                   - 좋아요 비율(likeCount/viewCount)이 높은 영상 우선
                   - 제목이 구체적이고 명확한 영상 선호
                   - 영상 길이(duration): 너무 짧은 영상은 우선순위 낮춤
                   - 최신성: 최근 영상일 수록 (단, 종목 관련성이 더 중요)

                4. 다양성 확보
                   - 가능한 한 서로 다른 채널(channelTitle)의 영상을 선정하세요.
                   - 같은 채널의 영상은 최대 2개까지만 허용합니다.
                   - 다양한 관점의 영상을 추천하세요 (ex. 기술 분석 + 재무 분석 + 산업 전망)

            ### 출력 형식 [반드시 준수]
                - JSON 배열 형식으로만 출력하세요: ["videoId1", "videoId2", "videoId3", ...]
                - 영상 목록에 실제로 존재하는 videoId만을 선택하세요.
                - 절대로 videoId를 추측하거나 생성하지 마세요.
                - videoId는 문자열 형태로 출력하세요. (숫자여도 따옴표로 감싸기)
                - 어떠한 설명이나 추가 텍스트도 포함하지 마세요.
                - JSON 배열 외 다른 내용은 절대 출력하지 마세요.

            ### 추천 대상 종목명:
            ${STOCK_NAME}

            ### 입력 JSON:
            ${INPUT}
        
            ### 이전에 추천된 videoId 목록:
            ${PREV}
        
            ## 추천 영상 개수
            ${RECOMMEND_AMOUNT}
        """;
}
